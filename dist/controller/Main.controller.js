sap.ui.define(["./BaseController","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t,s,r){"use strict";return e.extend("myapp.controller.Main",{onInit:function(){var e=new r({selectedFiles:[]});this.getView().setModel(e);this._setupMobileCameraCapture()},sayHello:function(){t.show("Hello World!")},_setupMobileCameraCapture:function(){setTimeout(()=>{if(sap.ui.Device.system.phone||sap.ui.Device.system.tablet){var e=this.byId("imageFileUploader");if(e&&e.oFileUpload){e.oFileUpload.setAttribute("capture","environment");e.oFileUpload.setAttribute("accept","image/*")}}},100)},onFileChange:function(e){var t=e.getSource();var r=e.getParameter("files")[0];if(!r){return}if(!this._validateFile(r)){t.clear();return}var i=this.getView().getModel();var o=i.getProperty("/selectedFiles");var l=o.some(function(e){return e.name===r.name&&e.size===r.size});if(l){s.show(this.getResourceBundle().getText("fileAlreadySelected"));t.clear();return}o.push({name:r.name,size:this._formatFileSize(r.size),file:r});i.setProperty("/selectedFiles",o);this.byId("selectedFilesBox").setVisible(true);this.byId("uploadButton").setEnabled(true);s.show(this.getResourceBundle().getText("itemAdded",[r.name]));t.clear()},_validateFile:function(e){var s=e.name;var r=s.split(".").pop().toLowerCase();var i=["jpg","jpeg","png","gif"];if(i.indexOf(r)===-1){t.error(this.getResourceBundle().getText("invalidFileType"));return false}if(e.size>10485760){t.error(this.getResourceBundle().getText("fileTooLarge"));return false}return true},_formatFileSize:function(e){if(e===0)return"0 Bytes";var t=1024;var s=["Bytes","KB","MB","GB"];var r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+s[r]},onDeleteFile:function(e){var t=e.getSource();var r=e.getParameter("listItem");var i=t.indexOfItem(r);var o=this.getView().getModel();var l=o.getProperty("/selectedFiles");var a=l[i].name;l.splice(i,1);o.setProperty("/selectedFiles",l);if(l.length===0){this.byId("selectedFilesBox").setVisible(false);this.byId("uploadButton").setEnabled(false)}s.show(this.getResourceBundle().getText("itemRemoved",[a]))},onUploadPress:function(){var e=this.getView().getModel();var t=e.getProperty("/selectedFiles");if(t.length===0){s.show(this.getResourceBundle().getText("noFilesToUpload"));return}s.show(this.getResourceBundle().getText("uploadStarted"));t.forEach((e,t)=>{this._uploadFile(e.file,t)})},_uploadFile:function(e,r){var i=new FormData;i.append("file",e);i.append("filename",e.name);i.append("filesize",e.size);var o=new XMLHttpRequest;o.onload=()=>{if(o.status===200||o.status===201){s.show(this.getResourceBundle().getText("uploadSuccess",[e.name]));this._removeUploadedFile(r)}else{t.error(this.getResourceBundle().getText("uploadError",[e.name]))}};o.onerror=()=>{t.error(this.getResourceBundle().getText("uploadError",[e.name]))};o.open("POST","/post");o.send(i)},_removeUploadedFile:function(e){var t=this.getView().getModel();var s=t.getProperty("/selectedFiles");s.splice(e,1);t.setProperty("/selectedFiles",s);if(s.length===0){this.byId("selectedFilesBox").setVisible(false);this.byId("uploadButton").setEnabled(false)}},onUploadComplete:function(e){var r=e.getParameter("status");var i=e.getParameter("response");if(r===200||r===201){s.show(this.getResourceBundle().getText("uploadSuccess",["file"]))}else{t.error(this.getResourceBundle().getText("uploadError",["file"]))}}})});
//# sourceMappingURL=Main.controller.js.map